!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(t=t||self).CSSCamera=r()}(this,function(){"use strict";var T=1e-6,m="undefined"!=typeof Float32Array?Float32Array:Array;Math.random,Math.PI;function i(t,r,a,n,e,o,i,s,u,h,c,f,M,l,p,v){var b=new m(16);return b[0]=t,b[1]=r,b[2]=a,b[3]=n,b[4]=e,b[5]=o,b[6]=i,b[7]=s,b[8]=u,b[9]=h,b[10]=c,b[11]=f,b[12]=M,b[13]=l,b[14]=p,b[15]=v,b}function x(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function t(t,r,a){var n=r[0],e=r[1],o=r[2],i=r[3],s=r[4],u=r[5],h=r[6],c=r[7],f=r[8],M=r[9],l=r[10],p=r[11],v=r[12],b=r[13],m=r[14],d=r[15],w=a[0],g=a[1],y=a[2],_=a[3];return t[0]=w*n+g*s+y*f+_*v,t[1]=w*e+g*u+y*M+_*b,t[2]=w*o+g*h+y*l+_*m,t[3]=w*i+g*c+y*p+_*d,w=a[4],g=a[5],y=a[6],_=a[7],t[4]=w*n+g*s+y*f+_*v,t[5]=w*e+g*u+y*M+_*b,t[6]=w*o+g*h+y*l+_*m,t[7]=w*i+g*c+y*p+_*d,w=a[8],g=a[9],y=a[10],_=a[11],t[8]=w*n+g*s+y*f+_*v,t[9]=w*e+g*u+y*M+_*b,t[10]=w*o+g*h+y*l+_*m,t[11]=w*i+g*c+y*p+_*d,w=a[12],g=a[13],y=a[14],_=a[15],t[12]=w*n+g*s+y*f+_*v,t[13]=w*e+g*u+y*M+_*b,t[14]=w*o+g*h+y*l+_*m,t[15]=w*i+g*c+y*p+_*d,t}function M(t,r,a){var n=r[0],e=r[1],o=r[2],i=r[3],s=n+n,u=e+e,h=o+o,c=n*s,f=n*u,M=n*h,l=e*u,p=e*h,v=o*h,b=i*s,m=i*u,d=i*h;return t[0]=1-(l+v),t[1]=f+d,t[2]=M-m,t[3]=0,t[4]=f-d,t[5]=1-(c+v),t[6]=p+b,t[7]=0,t[8]=M+m,t[9]=p-b,t[10]=1-(c+l),t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t}function r(t,r,a){return t[0]=r[0]-a[0],t[1]=r[1]-a[1],t[2]=r[2]-a[2],t[3]=r[3]-a[3],t[4]=r[4]-a[4],t[5]=r[5]-a[5],t[6]=r[6]-a[6],t[7]=r[7]-a[7],t[8]=r[8]-a[8],t[9]=r[9]-a[9],t[10]=r[10]-a[10],t[11]=r[11]-a[11],t[12]=r[12]-a[12],t[13]=r[13]-a[13],t[14]=r[14]-a[14],t[15]=r[15]-a[15],t}var s=t,u={create:function(){var t=new m(16);return m!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},clone:function(t){var r=new m(16);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},copy:function(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},fromValues:i,set:function(t,r,a,n,e,o,i,s,u,h,c,f,M,l,p,v,b){return t[0]=r,t[1]=a,t[2]=n,t[3]=e,t[4]=o,t[5]=i,t[6]=s,t[7]=u,t[8]=h,t[9]=c,t[10]=f,t[11]=M,t[12]=l,t[13]=p,t[14]=v,t[15]=b,t},identity:x,transpose:function(t,r){if(t===r){var a=r[1],n=r[2],e=r[3],o=r[6],i=r[7],s=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=a,t[6]=r[9],t[7]=r[13],t[8]=n,t[9]=o,t[11]=r[14],t[12]=e,t[13]=i,t[14]=s}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t},invert:function(t,r){var a=r[0],n=r[1],e=r[2],o=r[3],i=r[4],s=r[5],u=r[6],h=r[7],c=r[8],f=r[9],M=r[10],l=r[11],p=r[12],v=r[13],b=r[14],m=r[15],d=a*s-n*i,w=a*u-e*i,g=a*h-o*i,y=n*u-e*s,_=n*h-o*s,x=e*h-o*u,E=c*v-f*p,q=c*b-M*p,P=c*m-l*p,S=f*b-M*v,O=f*m-l*v,A=M*m-l*b,R=d*A-w*O+g*S+y*P-_*q+x*E;return R?(R=1/R,t[0]=(s*A-u*O+h*S)*R,t[1]=(e*O-n*A-o*S)*R,t[2]=(v*x-b*_+m*y)*R,t[3]=(M*_-f*x-l*y)*R,t[4]=(u*P-i*A-h*q)*R,t[5]=(a*A-e*P+o*q)*R,t[6]=(b*g-p*x-m*w)*R,t[7]=(c*x-M*g+l*w)*R,t[8]=(i*O-s*P+h*E)*R,t[9]=(n*P-a*O-o*E)*R,t[10]=(p*_-v*g+m*d)*R,t[11]=(f*g-c*_-l*d)*R,t[12]=(s*q-i*S-u*E)*R,t[13]=(a*S-n*q+e*E)*R,t[14]=(v*w-p*y-b*d)*R,t[15]=(c*y-f*w+M*d)*R,t):null},adjoint:function(t,r){var a=r[0],n=r[1],e=r[2],o=r[3],i=r[4],s=r[5],u=r[6],h=r[7],c=r[8],f=r[9],M=r[10],l=r[11],p=r[12],v=r[13],b=r[14],m=r[15];return t[0]=s*(M*m-l*b)-f*(u*m-h*b)+v*(u*l-h*M),t[1]=-(n*(M*m-l*b)-f*(e*m-o*b)+v*(e*l-o*M)),t[2]=n*(u*m-h*b)-s*(e*m-o*b)+v*(e*h-o*u),t[3]=-(n*(u*l-h*M)-s*(e*l-o*M)+f*(e*h-o*u)),t[4]=-(i*(M*m-l*b)-c*(u*m-h*b)+p*(u*l-h*M)),t[5]=a*(M*m-l*b)-c*(e*m-o*b)+p*(e*l-o*M),t[6]=-(a*(u*m-h*b)-i*(e*m-o*b)+p*(e*h-o*u)),t[7]=a*(u*l-h*M)-i*(e*l-o*M)+c*(e*h-o*u),t[8]=i*(f*m-l*v)-c*(s*m-h*v)+p*(s*l-h*f),t[9]=-(a*(f*m-l*v)-c*(n*m-o*v)+p*(n*l-o*f)),t[10]=a*(s*m-h*v)-i*(n*m-o*v)+p*(n*h-o*s),t[11]=-(a*(s*l-h*f)-i*(n*l-o*f)+c*(n*h-o*s)),t[12]=-(i*(f*b-M*v)-c*(s*b-u*v)+p*(s*M-u*f)),t[13]=a*(f*b-M*v)-c*(n*b-e*v)+p*(n*M-e*f),t[14]=-(a*(s*b-u*v)-i*(n*b-e*v)+p*(n*u-e*s)),t[15]=a*(s*M-u*f)-i*(n*M-e*f)+c*(n*u-e*s),t},determinant:function(t){var r=t[0],a=t[1],n=t[2],e=t[3],o=t[4],i=t[5],s=t[6],u=t[7],h=t[8],c=t[9],f=t[10],M=t[11],l=t[12],p=t[13],v=t[14],b=t[15];return(r*i-a*o)*(f*b-M*v)-(r*s-n*o)*(c*b-M*p)+(r*u-e*o)*(c*v-f*p)+(a*s-n*i)*(h*b-M*l)-(a*u-e*i)*(h*v-f*l)+(n*u-e*s)*(h*p-c*l)},multiply:t,translate:function(t,r,a){var n,e,o,i,s,u,h,c,f,M,l,p,v=a[0],b=a[1],m=a[2];return r===t?(t[12]=r[0]*v+r[4]*b+r[8]*m+r[12],t[13]=r[1]*v+r[5]*b+r[9]*m+r[13],t[14]=r[2]*v+r[6]*b+r[10]*m+r[14],t[15]=r[3]*v+r[7]*b+r[11]*m+r[15]):(n=r[0],e=r[1],o=r[2],i=r[3],s=r[4],u=r[5],h=r[6],c=r[7],f=r[8],M=r[9],l=r[10],p=r[11],t[0]=n,t[1]=e,t[2]=o,t[3]=i,t[4]=s,t[5]=u,t[6]=h,t[7]=c,t[8]=f,t[9]=M,t[10]=l,t[11]=p,t[12]=n*v+s*b+f*m+r[12],t[13]=e*v+u*b+M*m+r[13],t[14]=o*v+h*b+l*m+r[14],t[15]=i*v+c*b+p*m+r[15]),t},scale:function(t,r,a){var n=a[0],e=a[1],o=a[2];return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t[4]=r[4]*e,t[5]=r[5]*e,t[6]=r[6]*e,t[7]=r[7]*e,t[8]=r[8]*o,t[9]=r[9]*o,t[10]=r[10]*o,t[11]=r[11]*o,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},rotate:function(t,r,a,n){var e,o,i,s,u,h,c,f,M,l,p,v,b,m,d,w,g,y,_,x,E,q,P,S,O=n[0],A=n[1],R=n[2],j=Math.sqrt(O*O+A*A+R*R);return j<T?null:(O*=j=1/j,A*=j,R*=j,e=Math.sin(a),i=1-(o=Math.cos(a)),s=r[0],u=r[1],h=r[2],c=r[3],f=r[4],M=r[5],l=r[6],p=r[7],v=r[8],b=r[9],m=r[10],d=r[11],w=O*O*i+o,g=A*O*i+R*e,y=R*O*i-A*e,_=O*A*i-R*e,x=A*A*i+o,E=R*A*i+O*e,q=O*R*i+A*e,P=A*R*i-O*e,S=R*R*i+o,t[0]=s*w+f*g+v*y,t[1]=u*w+M*g+b*y,t[2]=h*w+l*g+m*y,t[3]=c*w+p*g+d*y,t[4]=s*_+f*x+v*E,t[5]=u*_+M*x+b*E,t[6]=h*_+l*x+m*E,t[7]=c*_+p*x+d*E,t[8]=s*q+f*P+v*S,t[9]=u*q+M*P+b*S,t[10]=h*q+l*P+m*S,t[11]=c*q+p*P+d*S,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)},rotateX:function(t,r,a){var n=Math.sin(a),e=Math.cos(a),o=r[4],i=r[5],s=r[6],u=r[7],h=r[8],c=r[9],f=r[10],M=r[11];return r!==t&&(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[4]=o*e+h*n,t[5]=i*e+c*n,t[6]=s*e+f*n,t[7]=u*e+M*n,t[8]=h*e-o*n,t[9]=c*e-i*n,t[10]=f*e-s*n,t[11]=M*e-u*n,t},rotateY:function(t,r,a){var n=Math.sin(a),e=Math.cos(a),o=r[0],i=r[1],s=r[2],u=r[3],h=r[8],c=r[9],f=r[10],M=r[11];return r!==t&&(t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=o*e-h*n,t[1]=i*e-c*n,t[2]=s*e-f*n,t[3]=u*e-M*n,t[8]=o*n+h*e,t[9]=i*n+c*e,t[10]=s*n+f*e,t[11]=u*n+M*e,t},rotateZ:function(t,r,a){var n=Math.sin(a),e=Math.cos(a),o=r[0],i=r[1],s=r[2],u=r[3],h=r[4],c=r[5],f=r[6],M=r[7];return r!==t&&(t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=o*e+h*n,t[1]=i*e+c*n,t[2]=s*e+f*n,t[3]=u*e+M*n,t[4]=h*e-o*n,t[5]=c*e-i*n,t[6]=f*e-s*n,t[7]=M*e-u*n,t},fromTranslation:function(t,r){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},fromScaling:function(t,r){return t[0]=r[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=r[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotation:function(t,r,a){var n,e,o,i=a[0],s=a[1],u=a[2],h=Math.sqrt(i*i+s*s+u*u);return h<T?null:(i*=h=1/h,s*=h,u*=h,n=Math.sin(r),o=1-(e=Math.cos(r)),t[0]=i*i*o+e,t[1]=s*i*o+u*n,t[2]=u*i*o-s*n,t[3]=0,t[4]=i*s*o-u*n,t[5]=s*s*o+e,t[6]=u*s*o+i*n,t[7]=0,t[8]=i*u*o+s*n,t[9]=s*u*o-i*n,t[10]=u*u*o+e,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},fromXRotation:function(t,r){var a=Math.sin(r),n=Math.cos(r);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=a,t[7]=0,t[8]=0,t[9]=-a,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromYRotation:function(t,r){var a=Math.sin(r),n=Math.cos(r);return t[0]=n,t[1]=0,t[2]=-a,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=a,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromZRotation:function(t,r){var a=Math.sin(r),n=Math.cos(r);return t[0]=n,t[1]=a,t[2]=0,t[3]=0,t[4]=-a,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotationTranslation:M,fromQuat2:function(t,r){var a=new m(3),n=-r[0],e=-r[1],o=-r[2],i=r[3],s=r[4],u=r[5],h=r[6],c=r[7],f=n*n+e*e+o*o+i*i;return 0<f?(a[0]=2*(s*i+c*n+u*o-h*e)/f,a[1]=2*(u*i+c*e+h*n-s*o)/f,a[2]=2*(h*i+c*o+s*e-u*n)/f):(a[0]=2*(s*i+c*n+u*o-h*e),a[1]=2*(u*i+c*e+h*n-s*o),a[2]=2*(h*i+c*o+s*e-u*n)),M(t,r,a),t},getTranslation:function(t,r){return t[0]=r[12],t[1]=r[13],t[2]=r[14],t},getScaling:function(t,r){var a=r[0],n=r[1],e=r[2],o=r[4],i=r[5],s=r[6],u=r[8],h=r[9],c=r[10];return t[0]=Math.sqrt(a*a+n*n+e*e),t[1]=Math.sqrt(o*o+i*i+s*s),t[2]=Math.sqrt(u*u+h*h+c*c),t},getRotation:function(t,r){var a=r[0]+r[5]+r[10],n=0;return 0<a?(n=2*Math.sqrt(a+1),t[3]=.25*n,t[0]=(r[6]-r[9])/n,t[1]=(r[8]-r[2])/n,t[2]=(r[1]-r[4])/n):r[0]>r[5]&&r[0]>r[10]?(n=2*Math.sqrt(1+r[0]-r[5]-r[10]),t[3]=(r[6]-r[9])/n,t[0]=.25*n,t[1]=(r[1]+r[4])/n,t[2]=(r[8]+r[2])/n):r[5]>r[10]?(n=2*Math.sqrt(1+r[5]-r[0]-r[10]),t[3]=(r[8]-r[2])/n,t[0]=(r[1]+r[4])/n,t[1]=.25*n,t[2]=(r[6]+r[9])/n):(n=2*Math.sqrt(1+r[10]-r[0]-r[5]),t[3]=(r[1]-r[4])/n,t[0]=(r[8]+r[2])/n,t[1]=(r[6]+r[9])/n,t[2]=.25*n),t},fromRotationTranslationScale:function(t,r,a,n){var e=r[0],o=r[1],i=r[2],s=r[3],u=e+e,h=o+o,c=i+i,f=e*u,M=e*h,l=e*c,p=o*h,v=o*c,b=i*c,m=s*u,d=s*h,w=s*c,g=n[0],y=n[1],_=n[2];return t[0]=(1-(p+b))*g,t[1]=(M+w)*g,t[2]=(l-d)*g,t[3]=0,t[4]=(M-w)*y,t[5]=(1-(f+b))*y,t[6]=(v+m)*y,t[7]=0,t[8]=(l+d)*_,t[9]=(v-m)*_,t[10]=(1-(f+p))*_,t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t},fromRotationTranslationScaleOrigin:function(t,r,a,n,e){var o=r[0],i=r[1],s=r[2],u=r[3],h=o+o,c=i+i,f=s+s,M=o*h,l=o*c,p=o*f,v=i*c,b=i*f,m=s*f,d=u*h,w=u*c,g=u*f,y=n[0],_=n[1],x=n[2],E=e[0],q=e[1],P=e[2],S=(1-(v+m))*y,O=(l+g)*y,A=(p-w)*y,R=(l-g)*_,j=(1-(M+m))*_,F=(b+d)*_,C=(p+w)*x,T=(b-d)*x,I=(1-(M+v))*x;return t[0]=S,t[1]=O,t[2]=A,t[3]=0,t[4]=R,t[5]=j,t[6]=F,t[7]=0,t[8]=C,t[9]=T,t[10]=I,t[11]=0,t[12]=a[0]+E-(S*E+R*q+C*P),t[13]=a[1]+q-(O*E+j*q+T*P),t[14]=a[2]+P-(A*E+F*q+I*P),t[15]=1,t},fromQuat:function(t,r){var a=r[0],n=r[1],e=r[2],o=r[3],i=a+a,s=n+n,u=e+e,h=a*i,c=n*i,f=n*s,M=e*i,l=e*s,p=e*u,v=o*i,b=o*s,m=o*u;return t[0]=1-f-p,t[1]=c+m,t[2]=M-b,t[3]=0,t[4]=c-m,t[5]=1-h-p,t[6]=l+v,t[7]=0,t[8]=M+b,t[9]=l-v,t[10]=1-h-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},frustum:function(t,r,a,n,e,o,i){var s=1/(a-r),u=1/(e-n),h=1/(o-i);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(a+r)*s,t[9]=(e+n)*u,t[10]=(i+o)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=i*o*2*h,t[15]=0,t},perspective:function(t,r,a,n,e){var o,i=1/Math.tan(r/2);return t[0]=i/a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=e&&e!==1/0?(o=1/(n-e),t[10]=(e+n)*o,t[14]=2*e*n*o):(t[10]=-1,t[14]=-2*n),t},perspectiveFromFieldOfView:function(t,r,a,n){var e=Math.tan(r.upDegrees*Math.PI/180),o=Math.tan(r.downDegrees*Math.PI/180),i=Math.tan(r.leftDegrees*Math.PI/180),s=Math.tan(r.rightDegrees*Math.PI/180),u=2/(i+s),h=2/(e+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-(i-s)*u*.5,t[9]=(e-o)*h*.5,t[10]=n/(a-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*a/(a-n),t[15]=0,t},ortho:function(t,r,a,n,e,o,i){var s=1/(r-a),u=1/(n-e),h=1/(o-i);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(r+a)*s,t[13]=(e+n)*u,t[14]=(i+o)*h,t[15]=1,t},lookAt:function(t,r,a,n){var e,o,i,s,u,h,c,f,M,l,p=r[0],v=r[1],b=r[2],m=n[0],d=n[1],w=n[2],g=a[0],y=a[1],_=a[2];return Math.abs(p-g)<T&&Math.abs(v-y)<T&&Math.abs(b-_)<T?x(t):(c=p-g,f=v-y,M=b-_,e=d*(M*=l=1/Math.sqrt(c*c+f*f+M*M))-w*(f*=l),o=w*(c*=l)-m*M,i=m*f-d*c,(l=Math.sqrt(e*e+o*o+i*i))?(e*=l=1/l,o*=l,i*=l):i=o=e=0,s=f*i-M*o,u=M*e-c*i,h=c*o-f*e,(l=Math.sqrt(s*s+u*u+h*h))?(s*=l=1/l,u*=l,h*=l):h=u=s=0,t[0]=e,t[1]=s,t[2]=c,t[3]=0,t[4]=o,t[5]=u,t[6]=f,t[7]=0,t[8]=i,t[9]=h,t[10]=M,t[11]=0,t[12]=-(e*p+o*v+i*b),t[13]=-(s*p+u*v+h*b),t[14]=-(c*p+f*v+M*b),t[15]=1,t)},targetTo:function(t,r,a,n){var e=r[0],o=r[1],i=r[2],s=n[0],u=n[1],h=n[2],c=e-a[0],f=o-a[1],M=i-a[2],l=c*c+f*f+M*M;0<l&&(c*=l=1/Math.sqrt(l),f*=l,M*=l);var p=u*M-h*f,v=h*c-s*M,b=s*f-u*c;return 0<(l=p*p+v*v+b*b)&&(p*=l=1/Math.sqrt(l),v*=l,b*=l),t[0]=p,t[1]=v,t[2]=b,t[3]=0,t[4]=f*b-M*v,t[5]=M*p-c*b,t[6]=c*v-f*p,t[7]=0,t[8]=c,t[9]=f,t[10]=M,t[11]=0,t[12]=e,t[13]=o,t[14]=i,t[15]=1,t},str:function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},frob:function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},add:function(t,r,a){return t[0]=r[0]+a[0],t[1]=r[1]+a[1],t[2]=r[2]+a[2],t[3]=r[3]+a[3],t[4]=r[4]+a[4],t[5]=r[5]+a[5],t[6]=r[6]+a[6],t[7]=r[7]+a[7],t[8]=r[8]+a[8],t[9]=r[9]+a[9],t[10]=r[10]+a[10],t[11]=r[11]+a[11],t[12]=r[12]+a[12],t[13]=r[13]+a[13],t[14]=r[14]+a[14],t[15]=r[15]+a[15],t},subtract:r,multiplyScalar:function(t,r,a){return t[0]=r[0]*a,t[1]=r[1]*a,t[2]=r[2]*a,t[3]=r[3]*a,t[4]=r[4]*a,t[5]=r[5]*a,t[6]=r[6]*a,t[7]=r[7]*a,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=r[11]*a,t[12]=r[12]*a,t[13]=r[13]*a,t[14]=r[14]*a,t[15]=r[15]*a,t},multiplyScalarAndAdd:function(t,r,a,n){return t[0]=r[0]+a[0]*n,t[1]=r[1]+a[1]*n,t[2]=r[2]+a[2]*n,t[3]=r[3]+a[3]*n,t[4]=r[4]+a[4]*n,t[5]=r[5]+a[5]*n,t[6]=r[6]+a[6]*n,t[7]=r[7]+a[7]*n,t[8]=r[8]+a[8]*n,t[9]=r[9]+a[9]*n,t[10]=r[10]+a[10]*n,t[11]=r[11]+a[11]*n,t[12]=r[12]+a[12]*n,t[13]=r[13]+a[13]*n,t[14]=r[14]+a[14]*n,t[15]=r[15]+a[15]*n,t},exactEquals:function(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]&&t[4]===r[4]&&t[5]===r[5]&&t[6]===r[6]&&t[7]===r[7]&&t[8]===r[8]&&t[9]===r[9]&&t[10]===r[10]&&t[11]===r[11]&&t[12]===r[12]&&t[13]===r[13]&&t[14]===r[14]&&t[15]===r[15]},equals:function(t,r){var a=t[0],n=t[1],e=t[2],o=t[3],i=t[4],s=t[5],u=t[6],h=t[7],c=t[8],f=t[9],M=t[10],l=t[11],p=t[12],v=t[13],b=t[14],m=t[15],d=r[0],w=r[1],g=r[2],y=r[3],_=r[4],x=r[5],E=r[6],q=r[7],P=r[8],S=r[9],O=r[10],A=r[11],R=r[12],j=r[13],F=r[14],C=r[15];return Math.abs(a-d)<=T*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(n-w)<=T*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(e-g)<=T*Math.max(1,Math.abs(e),Math.abs(g))&&Math.abs(o-y)<=T*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(i-_)<=T*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(s-x)<=T*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(u-E)<=T*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-q)<=T*Math.max(1,Math.abs(h),Math.abs(q))&&Math.abs(c-P)<=T*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(f-S)<=T*Math.max(1,Math.abs(f),Math.abs(S))&&Math.abs(M-O)<=T*Math.max(1,Math.abs(M),Math.abs(O))&&Math.abs(l-A)<=T*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(p-R)<=T*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(v-j)<=T*Math.max(1,Math.abs(v),Math.abs(j))&&Math.abs(b-F)<=T*Math.max(1,Math.abs(b),Math.abs(F))&&Math.abs(m-C)<=T*Math.max(1,Math.abs(m),Math.abs(C))},mul:s,sub:r};function a(){var t=new m(3);return m!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function h(t,r,a){var n=new m(3);return n[0]=t,n[1]=r,n[2]=a,n}function c(t,r,a){return t[0]=r[0]+a[0],t[1]=r[1]+a[1],t[2]=r[2]+a[2],t}function n(t,r,a){var n=r[0],e=r[1],o=r[2],i=a[0],s=a[1],u=a[2];return t[0]=e*u-o*s,t[1]=o*i-n*u,t[2]=n*s-e*i,t}var e,o=function(t){var r=t[0],a=t[1],n=t[2];return Math.sqrt(r*r+a*a+n*n)};e=a();var f;f=function(){var t=new m(4);return m!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}();function l(){var t=new m(4);return m!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function p(t,r,a){a*=.5;var n=Math.sin(a);return t[0]=n*r[0],t[1]=n*r[1],t[2]=n*r[2],t[3]=Math.cos(a),t}function v(t,r,a,n){var e,o,i,s,u,h=r[0],c=r[1],f=r[2],M=r[3],l=a[0],p=a[1],v=a[2],b=a[3];return(o=h*l+c*p+f*v+M*b)<0&&(o=-o,l=-l,p=-p,v=-v,b=-b),u=T<1-o?(e=Math.acos(o),i=Math.sin(e),s=Math.sin((1-n)*e)/i,Math.sin(n*e)/i):(s=1-n,n),t[0]=s*h+u*l,t[1]=s*c+u*p,t[2]=s*f+u*v,t[3]=s*M+u*b,t}function b(t,r){var a=r[0],n=r[1],e=r[2],o=r[3],i=a*a+n*n+e*e+o*o,s=i?1/i:0;return t[0]=-a*s,t[1]=-n*s,t[2]=-e*s,t[3]=o*s,t}function d(t,r){var a,n=r[0]+r[4]+r[8];if(0<n)a=Math.sqrt(n+1),t[3]=.5*a,a=.5/a,t[0]=(r[5]-r[7])*a,t[1]=(r[6]-r[2])*a,t[2]=(r[1]-r[3])*a;else{var e=0;r[4]>r[0]&&(e=1),r[8]>r[3*e+e]&&(e=2);var o=(e+1)%3,i=(e+2)%3;a=Math.sqrt(r[3*e+e]-r[3*o+o]-r[3*i+i]+1),t[e]=.5*a,a=.5/a,t[3]=(r[3*o+i]-r[3*i+o])*a,t[o]=(r[3*o+e]+r[3*e+o])*a,t[i]=(r[3*i+e]+r[3*e+i])*a}return t}function w(t,r,a,n){var e=.5*Math.PI/180;r*=e,a*=e,n*=e;var o=Math.sin(r),i=Math.cos(r),s=Math.sin(a),u=Math.cos(a),h=Math.sin(n),c=Math.cos(n);return t[0]=o*u*c-i*s*h,t[1]=i*s*c+o*u*h,t[2]=i*u*h-o*s*c,t[3]=i*u*c+o*s*h,t}var g,y,_,E,q,P,S=function(t,r){var a=r[0],n=r[1],e=r[2],o=r[3],i=a*a+n*n+e*e+o*o;return 0<i&&(i=1/Math.sqrt(i)),t[0]=a*i,t[1]=n*i,t[2]=e*i,t[3]=o*i,t};g=a(),y=h(1,0,0),_=h(0,1,0),E=l(),q=l(),P=function(){var t=new m(9);return m!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}();O=function(){var t=new m(2);return m!=Float32Array&&(t[0]=0,t[1]=0),t}();var O,A,R=(A=j.prototype,Object.defineProperty(A,"position",{get:function(){return this._position},enumerable:!0,configurable:!0}),Object.defineProperty(A,"scale",{get:function(){return this._scale},enumerable:!0,configurable:!0}),Object.defineProperty(A,"rotation",{get:function(){return this._rotation},enumerable:!0,configurable:!0}),Object.defineProperty(A,"perspective",{get:function(){return this._perspective},set:function(t){this._perspective=t},enumerable:!0,configurable:!0}),Object.defineProperty(A,"cameraCSS",{get:function(){var t=this._perspective,r=this._rotation;return"translateZ("+t+"px) rotateY("+r[1]+"deg) rotateZ("+r[2]+"deg) rotateX("+r[0]+"deg)"},enumerable:!0,configurable:!0}),Object.defineProperty(A,"worldCSS",{get:function(){var t=this._perspective,r=this._position;return"translate3d("+-r[0]+"px, "+-r[1]+"px, "+(-r[2]-t)+"px)"},enumerable:!0,configurable:!0}),A.translate=function(t,r,a){var n=h(t,r,a),e=this._rotation,o=l();w(o,e[0],e[1],e[2]),b(o,o),function(t,r,a){var n=a[0],e=a[1],o=a[2],i=a[3],s=r[0],u=r[1],h=r[2],c=e*h-o*u,f=o*s-n*h,M=n*u-e*s,l=e*M-o*f,p=o*c-n*M,v=n*f-e*c,b=2*i;c*=b,f*=b,M*=b,l*=2,p*=2,v*=2,t[0]=s+c+l,t[1]=u+f+p,t[2]=h+M+v}(n,n,o),c(this._position,this._position,n)},A.absTranslate=function(t,r,a){c(this._position,this._position,h(t,r,a))},A.rotateX=function(t){this._rotation[0]+=t},A.rotateY=function(t){this._rotation[1]+=t},A.rotateZ=function(t){this._rotation[2]+=t},j);function j(){this._position=a(),this._scale=h(1,1,1),this._rotation=a(),this._perspective=0}function F(r,a){Object.keys(a).forEach(function(t){r.style[t]=a[t]})}var C,I={width:"100%",height:"100%","transform-style":"preserve-3d"},D={VIEWPORT:"cc-viewport",CAMERA:"cc-camera",WORLD:"cc-world"},N=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function V(t){this._element=function(t){if("string"==typeof t){var r=document.querySelector(t);if(!r)throw new Error("Base element doesn't exist.");return r}if(t.nodeName&&1===t.nodeType)return t;throw new Error("Element should be provided in string or HTMLElement.")}(t),this._transform=new R;var r=this._element,a=document.createElement("div");F(a,I);var n=a.cloneNode(),e=a.cloneNode();a.className=D.VIEWPORT,n.className=D.CAMERA,e.className=D.WORLD,n.appendChild(e),a.appendChild(n),this._viewportEl=a,this._cameraEl=n,this._worldEl=e,r.parentElement.insertBefore(a,r),e.appendChild(r)}return C=V.prototype,Object.defineProperty(C,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0}),Object.defineProperty(C,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(C,"viewportEl",{get:function(){return this._viewportEl},enumerable:!0,configurable:!0}),Object.defineProperty(C,"cameraEl",{get:function(){return this._cameraEl},enumerable:!0,configurable:!0}),C.focus=function(t,r){void 0===r&&(r=N);var a=this.getFocusMatrix(t,r);console.log(a)},C.getFocusMatrix=function(t,r){void 0===r&&(r=N);for(var a=[];t&&(a.push(t),t!==this._element);)t=t.parentElement;a.reverse();var n=a.map(function(t){return window.getComputedStyle(t)}),e=function(t,r){for(var a=0;a<t.length;a+=1){var n=t[a];if(n&&r(n))return a}return-1}(n,function(t){return"preserve-3d"!==t.transformStyle});0<=e&&n.splice(e+1);var o=i.apply(u,r);return n.forEach(function(t){o=s(o,o,function(t){var r=t.getPropertyValue("transform"),a=/\(((\s|\S)+)\)/.exec(r),n=a?a[1].split(",").map(function(t){return parseFloat(t)}):[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return i.apply(u,n)}(t))}),o},C.setPerspective=function(t){F(this._viewportEl,{perspective:t+"px"}),this._transform.perspective=t,this.update()},C.update=function(){var t=this._transform;this._cameraEl.style.transform=t.cameraCSS,this._worldEl.style.transform=t.worldCSS},V});
//# sourceMappingURL=css-camera.pkgd.min.js.map
