/*
Copyright (c) 2019 WoodNeck
name: css-camera
license: MIT
author: WoodNeck
repository: git+https://github.com/WoodNeck/css-camera.git
version: 1.0.1
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("gl-matrix")):"function"==typeof define&&define.amd?define(["gl-matrix"],e):(t=t||self).CSSCamera=e(t["gl-matrix"])}(this,function(m){"use strict";var u=function(){return(u=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function t(r,n){var o,i,a,t,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(a=2&e[0]?i.return:e[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,e[1])).done)return a;switch(i=0,a&&(e=[2&e[0],a.value]),e[0]){case 0:case 1:a=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,i=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){c=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){c.label=e[1];break}if(6===e[0]&&c.label<a[1]){c.label=a[1],a=e;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(e);break}a[2]&&c.ops.pop(),c.trys.pop();continue}e=n.call(r,c)}catch(t){e=[6,t],i=0}finally{o=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function r(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||0<e--)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function g(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(r(arguments[e]));return t}function c(t,e){if("string"==typeof t){var r=e?e.querySelector(t):document.querySelector(t);if(!r)throw new Error(function(t){return'Element with selector "'+t+"\" doesn't exist."}(t));return r}if(t.nodeName&&1===t.nodeType)return t;throw new Error(function(t){return"Element should be provided in string or HTMLElement. Received: "+t}(t))}function s(e,r){Object.keys(r).forEach(function(t){e.style[t]=r[t]})}function f(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return t.forEach(function(r){Object.keys(r).forEach(function(t){var e=r[t];n[t]=e})}),n}function a(t){var e=m.mat4.create();m.mat4.fromQuat(e,t);var r=e[0],n=e[4],o=e[1],i=e[5],a=e[2],c=e[6],u=e[10],s=m.vec3.create();return s[1]=Math.asin(-function(t,e,r){return Math.max(Math.min(t,r),e)}(a,-1,1)),Math.abs(a)<.99999?(s[0]=Math.atan2(c,u),s[2]=Math.atan2(o,r)):(s[0]=0,s[2]=Math.atan2(-n,i)),s.map(function(t){return function(t){return 180*t/Math.PI}(t)})}var e,l={width:"100%",height:"100%","transform-style":"preserve-3d",overflow:"hidden"},h={width:"100%",height:"100%","transform-style":"preserve-3d","will-change":"transform"},p={width:"100%",height:"100%","transform-style":"preserve-3d","will-change":"transform"},v="cc-viewport",d="cc-camera",b="cc-world",y={position:[0,0,0],scale:[1,1,1],rotation:[0,0,0],perspective:0,rotateOffset:0},_={property:"transform",timingFunction:"ease-out",delay:"0ms"};function n(t,e){void 0===e&&(e={}),this._element=c(t);var r=f(f({},y),e);this._position=m.vec3.fromValues(r.position[0],r.position[1],r.position[2]),this._scale=m.vec3.fromValues(r.scale[0],r.scale[1],r.scale[2]),this._rotation=m.vec3.fromValues(r.rotation[0],r.rotation[1],r.rotation[2]),this._perspective=r.perspective,this._rotateOffset=r.rotateOffset,this._updateTimer=-1;var n=this._element,o=document.createElement("div"),i=o.cloneNode(),a=o.cloneNode();o.className=v,i.className=d,a.className=b,s(o,l),s(i,h),s(a,p),i.appendChild(a),o.appendChild(i),this._viewportEl=o,this._cameraEl=i,this._worldEl=a,n.parentElement.insertBefore(o,n),a.appendChild(n),this.update(0)}return e=n.prototype,Object.defineProperty(n,"VERSION",{get:function(){return"1.0.1"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(e,"viewportEl",{get:function(){return this._viewportEl},enumerable:!0,configurable:!0}),Object.defineProperty(e,"cameraEl",{get:function(){return this._cameraEl},enumerable:!0,configurable:!0}),Object.defineProperty(e,"worldEl",{get:function(){return this._worldEl},enumerable:!0,configurable:!0}),Object.defineProperty(e,"position",{get:function(){return g(this._position)},set:function(t){this._position=m.vec3.fromValues(t[0],t[1],t[2])},enumerable:!0,configurable:!0}),Object.defineProperty(e,"scale",{get:function(){return g(this._scale)},set:function(t){this._scale=m.vec3.fromValues(t[0],t[1],t[2])},enumerable:!0,configurable:!0}),Object.defineProperty(e,"rotation",{get:function(){return g(this._rotation)},set:function(t){this._rotation=m.vec3.fromValues(t[0],t[1],t[2])},enumerable:!0,configurable:!0}),Object.defineProperty(e,"quaternion",{get:function(){var t=this._rotation;return g(m.quat.fromEuler(m.quat.create(),t[0],t[1],t[2]))},set:function(t){this._rotation=a(m.quat.fromValues(t[0],t[1],t[2],t[3]))},enumerable:!0,configurable:!0}),Object.defineProperty(e,"perspective",{get:function(){return this._perspective},set:function(t){this._perspective=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"rotateOffset",{get:function(){return this._rotateOffset},set:function(t){this._rotateOffset=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"cameraCSS",{get:function(){var t=this._perspective,e=this._rotateOffset,r=this._rotation,n=this._scale;return"scale3d("+n[0]+", "+n[1]+", "+n[2]+") translateZ("+(t-e)+"px) rotateX("+r[0]+"deg) rotateY("+r[1]+"deg) rotateZ("+r[2]+"deg)"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"worldCSS",{get:function(){var t=this._position;return"translate3d("+-t[0]+"px, "+-t[1]+"px, "+-t[2]+"px)"},enumerable:!0,configurable:!0}),e.focus=function(t){var e=c(t),r=this._getFocusMatrix(e),n=m.quat.create(),o=m.vec3.create();m.mat4.getRotation(n,r),m.mat4.getTranslation(o,r);var i=a(n);return m.vec3.negate(i,i),this._rotation=i,this._position=o,this},e.translateLocal=function(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0);var n=this._position,o=this._rotation,i=m.vec3.fromValues(t,e,r),a=m.quat.create();return m.quat.fromEuler(a,-o[0],-o[1],-o[2]),m.vec3.transformQuat(i,i,a),m.vec3.add(n,n,i),this},e.translate=function(t,e,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),m.vec3.add(this._position,this._position,m.vec3.fromValues(t,e,r)),this},e.rotate=function(t,e,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),m.vec3.add(this._rotation,this._rotation,m.vec3.fromValues(t,e,r)),this},e.update=function(a,c){return void 0===a&&(a=0),void 0===c&&(c={}),function(i,a,c,u){return new(c||(c=Promise))(function(t,e){function r(t){try{o(u.next(t))}catch(t){e(t)}}function n(t){try{o(u.throw(t))}catch(t){e(t)}}function o(e){e.done?t(e.value):new c(function(t){t(e.value)}).then(r,n)}o((u=u.apply(i,a||[])).next())})}(this,void 0,Promise,function(){var r,e,n,o,i=this;return t(this,function(t){return s(this._viewportEl,{perspective:this.perspective+"px"}),s(this._cameraEl,{transform:this.cameraCSS}),s(this._worldEl,{transform:this.worldCSS}),r=f(f({},_),c),0<a&&(0<this._updateTimer&&window.clearTimeout(this._updateTimer),e=a+"ms",n=Object.keys(r).reduce(function(t,e){return t["transition"+(e.charAt(0).toUpperCase()+e.slice(1))]=r[e],t},{}),o=u({transitionDuration:e},n),[this._viewportEl,this._cameraEl,this._worldEl].forEach(function(t){s(t,o)})),[2,new Promise(function(t){0<a?i._updateTimer=window.setTimeout(function(){[i._viewportEl,i._cameraEl,i._worldEl].forEach(function(t){s(t,{transition:""})}),i._updateTimer=-1,t()},a):requestAnimationFrame(function(){t()})})]})})},e._getFocusMatrix=function(t){for(var h=[];t&&(h.push(t),t!==this._element);)t=t.parentElement;h.reverse();var e=h.map(function(t){return window.getComputedStyle(t)}),r=function(t,e){for(var r=0;r<t.length;r+=1){var n=t[r];if(n&&e(n))return r}return-1}(e,function(t){return"preserve-3d"!==t.transformStyle});0<r&&e.splice(r+1);var p={left:0,top:0,width:this.viewportEl.offsetWidth,height:this.viewportEl.offsetHeight},v=m.quat.identity(m.quat.create()),d=m.vec3.fromValues(0,0,0);e.forEach(function(t,e){var r=h[e],n={left:r.offsetLeft,top:r.offsetTop,width:r.offsetWidth,height:r.offsetHeight},o=function(t){var e=t.getPropertyValue("transform"),r=/\(((\s|\S)+)\)/.exec(e),n=r?r[1].split(",").map(function(t){return parseFloat(t)}):[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];if(16===n.length)return m.mat4.fromValues.apply(m.mat4,g(n));var o=m.mat4.create();return m.mat4.identity(o),o[0]=n[0],o[1]=n[1],o[4]=n[2],o[5]=n[3],o[12]=n[4],o[13]=n[5],o}(t),i=function(t,e){var r=t.left+(t.width-e.width)/2,n=t.top+(t.height-e.height)/2;return m.vec3.fromValues(r,n,0)}(n,p);m.vec3.transformQuat(i,i,v),m.vec3.add(d,d,i);var a=function(t,e){var r=t.transformOrigin.split(" ").map(function(t){return parseFloat(t.substring(0,t.length-2))}),n=r[0]-e.width/2,o=r[1]-e.height/2;return m.vec3.fromValues(n,o,0)}(t,n);m.vec3.transformQuat(a,a,v);var c=m.vec3.clone(d);m.vec3.add(c,c,a);var u=m.vec3.create();m.vec3.sub(u,d,c);var s=m.quat.invert(m.quat.create(),v);m.vec3.transformQuat(u,u,s),m.vec3.transformMat4(u,u,o),m.vec3.transformQuat(u,u,v);var f=m.vec3.add(m.vec3.create(),c,u),l=m.mat4.getRotation(m.quat.create(),o);m.vec3.copy(d,f),m.quat.mul(v,v,l),p=n});var n=m.vec3.fromValues(0,0,this.perspective);m.vec3.transformQuat(n,n,v),m.vec3.add(d,d,n);var o=m.mat4.create();return m.mat4.fromRotationTranslation(o,v,d),o},n});
//# sourceMappingURL=css-camera.min.js.map
