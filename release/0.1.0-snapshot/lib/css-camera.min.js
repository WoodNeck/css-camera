/*
Copyright (c) 2019 WoodNeck
name: css-camera
license: MIT
author: WoodNeck
repository: git+https://github.com/WoodNeck/css-camera.git
version: 0.1.0-snapshot
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("gl-matrix")):"function"==typeof define&&define.amd?define(["gl-matrix"],t):(e=e||self).CSSCamera=t(e["gl-matrix"])}(this,function(m){"use strict";var c=function(){return(c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function e(r,n){var i,o,a,e,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=2&t[0]?o.return:t[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,t[1])).done)return a;switch(o=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,o=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){c.label=t[1];break}if(6===t[0]&&c.label<a[1]){c.label=a[1],a=t;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(t);break}a[2]&&c.ops.pop(),c.trys.pop();continue}t=n.call(r,c)}catch(e){t=[6,e],o=0}finally{i=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function r(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function g(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(r(arguments[t]));return e}function a(e,t){if("string"==typeof e){var r=t?t.querySelector(e):document.querySelector(e);if(!r)throw new Error(function(e){return'Element with selector "'+e+"\" doesn't exist."}(e));return r}if(e.nodeName&&1===e.nodeType)return e;throw new Error(function(e){return"Element should be provided in string or HTMLElement. Received: "+e}(e))}function u(t,r){Object.keys(r).forEach(function(e){t.style[e]=r[e]})}function s(e){var t=m.mat4.create();m.mat4.fromQuat(t,e);var r=t[0],n=t[4],i=t[1],o=t[5],a=t[2],c=t[6],u=t[10],s=m.vec3.create();return s[1]=Math.asin(-function(e,t,r){return Math.max(Math.min(e,r),t)}(a,-1,1)),Math.abs(a)<.99999?(s[0]=Math.atan2(c,u),s[2]=Math.atan2(i,r)):(s[0]=0,s[2]=Math.atan2(-n,o)),s.map(function(e){return function(e){return 180*e/Math.PI}(e)})}var t,o={VIEWPORT:{width:"100%",height:"100%","transform-style":"preserve-3d",overflow:"hidden"},CAMERA:{width:"100%",height:"100%","transform-style":"preserve-3d","will-change":"transform"},WORLD:{width:"100%",height:"100%","transform-style":"preserve-3d","will-change":"transform"}},f={VIEWPORT:"cc-viewport",CAMERA:"cc-camera",WORLD:"cc-world"},l={property:"transform",timingFunction:"ease-out",delay:"0ms"};function n(e){this._element=a(e),this._position=m.vec3.create(),this._scale=m.vec3.fromValues(1,1,1),this._rotation=m.vec3.create(),this._perspective=0,this._perspectiveOffset=0,this._updateTimer=-1;var t=this._element,r=document.createElement("div"),n=r.cloneNode(),i=r.cloneNode();r.className=f.VIEWPORT,n.className=f.CAMERA,i.className=f.WORLD,u(r,o.VIEWPORT),u(n,o.CAMERA),u(i,o.WORLD),n.appendChild(i),r.appendChild(n),this._viewportEl=r,this._cameraEl=n,this._worldEl=i,t.parentElement.insertBefore(r,t),i.appendChild(t)}return t=n.prototype,Object.defineProperty(n,"VERSION",{get:function(){return"0.1.0-snapshot"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(t,"viewportEl",{get:function(){return this._viewportEl},enumerable:!0,configurable:!0}),Object.defineProperty(t,"cameraEl",{get:function(){return this._cameraEl},enumerable:!0,configurable:!0}),Object.defineProperty(t,"worldEl",{get:function(){return this._worldEl},enumerable:!0,configurable:!0}),Object.defineProperty(t,"position",{get:function(){return g(this._position)},set:function(e){this._position=m.vec3.fromValues(e[0],e[1],e[2])},enumerable:!0,configurable:!0}),Object.defineProperty(t,"scale",{get:function(){return g(this._scale)},set:function(e){this._scale=m.vec3.fromValues(e[0],e[1],e[2])},enumerable:!0,configurable:!0}),Object.defineProperty(t,"rotation",{get:function(){return g(this._rotation)},set:function(e){this._rotation=m.vec3.fromValues(e[0],e[1],e[2])},enumerable:!0,configurable:!0}),Object.defineProperty(t,"quaternion",{get:function(){var e=this._rotation;return g(m.quat.fromEuler(m.quat.create(),e[0],e[1],e[2]))},set:function(e){this._rotation=s(m.quat.fromValues(e[0],e[1],e[2],e[3]))},enumerable:!0,configurable:!0}),Object.defineProperty(t,"perspective",{get:function(){return this._perspective},set:function(e){this._perspective=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"perspectiveOffset",{get:function(){return this._perspectiveOffset},set:function(e){this._perspectiveOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"cameraCSS",{get:function(){var e=this._perspective,t=this._perspectiveOffset,r=this._rotation,n=this._scale;return"scale3d("+n[0]+", "+n[1]+", "+n[2]+") translateZ("+(e+t)+"px) rotateX("+r[0]+"deg) rotateY("+r[1]+"deg) rotateZ("+r[2]+"deg)"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"worldCSS",{get:function(){var e=this._position;return"translate3d("+-e[0]+"px, "+-e[1]+"px, "+-e[2]+"px)"},enumerable:!0,configurable:!0}),t.focus=function(e){var t=a(e),r=this._getFocusMatrix(t),n=m.quat.create(),i=m.vec3.create();m.mat4.getRotation(n,r),m.mat4.getTranslation(i,r);var o=s(n);return m.vec3.negate(o,o),this._rotation=o,this._position=i,this},t.translateLocal=function(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0);var n=this._position,i=this._rotation,o=m.vec3.fromValues(e,t,r),a=m.quat.create();return m.quat.fromEuler(a,-i[0],-i[1],-i[2]),m.vec3.transformQuat(o,o,a),m.vec3.add(n,n,o),this},t.translate=function(e,t,r){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),m.vec3.add(this._position,this._position,m.vec3.fromValues(e,t,r)),this},t.rotate=function(e,t,r){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),m.vec3.add(this._rotation,this._rotation,m.vec3.fromValues(e,t,r)),this},t.update=function(o,a){return void 0===o&&(o=0),void 0===a&&(a={}),function(o,a,c,u){return new(c||(c=Promise))(function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):new c(function(e){e(t.value)}).then(r,n)}i((u=u.apply(o,a||[])).next())})}(this,void 0,Promise,function(){var t,r,n,i=this;return e(this,function(e){return u(this._viewportEl,{perspective:this.perspective+"px"}),u(this._cameraEl,{transform:this.cameraCSS}),u(this._worldEl,{transform:this.worldCSS}),0<o&&(0<this._updateTimer&&window.clearTimeout(this._updateTimer),t=o+"ms",r=Object.assign(Object.assign({},l),a),n=Object.keys(r).reduce(function(e,t){return e["transition"+(t.charAt(0).toUpperCase()+t.slice(1))]=r[t],e},{}),u(this._cameraEl,c({transitionDuration:t},n)),u(this._worldEl,c({transitionDuration:t},n))),[2,new Promise(function(e){0<o?i._updateTimer=window.setTimeout(function(){u(i._cameraEl,{transition:""}),u(i._worldEl,{transition:""}),i._updateTimer=-1,e()},o):requestAnimationFrame(function(){e()})})]})})},t._getFocusMatrix=function(e){for(var h=[];e&&(h.push(e),e!==this._element);)e=e.parentElement;h.reverse();var t=h.map(function(e){return window.getComputedStyle(e)}),r=function(e,t){for(var r=0;r<e.length;r+=1){var n=e[r];if(n&&t(n))return r}return-1}(t,function(e){return"preserve-3d"!==e.transformStyle});0<r&&t.splice(r+1);var p={left:0,top:0,width:this.viewportEl.offsetWidth,height:this.viewportEl.offsetHeight},v=m.quat.identity(m.quat.create()),d=m.vec3.fromValues(0,0,0);t.forEach(function(e,t){var r=h[t],n={left:r.offsetLeft,top:r.offsetTop,width:r.offsetWidth,height:r.offsetHeight},i=function(e){var t=e.getPropertyValue("transform"),r=/\(((\s|\S)+)\)/.exec(t),n=r?r[1].split(",").map(function(e){return parseFloat(e)}):[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];if(16===n.length)return m.mat4.fromValues.apply(m.mat4,g(n));var i=m.mat4.create();return m.mat4.identity(i),i[0]=n[0],i[1]=n[1],i[4]=n[2],i[5]=n[3],i[12]=n[4],i[13]=n[5],i}(e),o=function(e,t){var r=e.left+(e.width-t.width)/2,n=e.top+(e.height-t.height)/2;return m.vec3.fromValues(r,n,0)}(n,p);m.vec3.transformQuat(o,o,v),m.vec3.add(d,d,o);var a=function(e,t){var r=e.transformOrigin.split(" ").map(function(e){return parseFloat(e.substring(0,e.length-2))}),n=r[0]-t.width/2,i=r[1]-t.height/2;return m.vec3.fromValues(n,i,0)}(e,n);m.vec3.transformQuat(a,a,v);var c=m.vec3.clone(d);m.vec3.add(c,c,a);var u=m.vec3.create();m.vec3.sub(u,d,c);var s=m.quat.invert(m.quat.create(),v);m.vec3.transformQuat(u,u,s),m.vec3.transformMat4(u,u,i),m.vec3.transformQuat(u,u,v);var f=m.vec3.add(m.vec3.create(),c,u),l=m.mat4.getRotation(m.quat.create(),i);m.vec3.copy(d,f),m.quat.mul(v,v,l),p=n});var n=m.vec3.fromValues(0,0,this.perspective);m.vec3.transformQuat(n,n,v),m.vec3.add(d,d,n);var i=m.mat4.create();return m.mat4.fromRotationTranslation(i,v,d),i},n});
//# sourceMappingURL=css-camera.min.js.map
